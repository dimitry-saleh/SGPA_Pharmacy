<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.SVGPath?>
<?import javafx.geometry.Insets?>

<ScrollPane fitToWidth="true" xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.pharmacy.sgpa.controller.DashboardController"
            stylesheets="@../css/styles.css"
            style="-fx-background-color: #F4F6F8; -fx-padding: 0;">

    <VBox spacing="25">
        <padding><Insets top="30" right="30" bottom="30" left="30"/></padding>

        <HBox alignment="CENTER_LEFT" spacing="20">
            <VBox>
                <Label text="Tableau de Bord" styleClass="page-title"/>
                <Label text="Aperçu global de la pharmacie" styleClass="subtitle-text"/>
            </VBox>

            <Region HBox.hgrow="ALWAYS"/>

            <HBox alignment="CENTER" spacing="10" styleClass="toolbar-container">
                <ComboBox fx:id="comboPeriod" prefWidth="140" promptText="Ce mois-ci" styleClass="combo-box-flat"/>
                <Separator orientation="VERTICAL"/>
                <DatePicker fx:id="dateStart" prefWidth="110" promptText="Début" styleClass="date-picker-flat"/>
                <Label text="➜" style="-fx-text-fill: #B0BEC5;"/>
                <DatePicker fx:id="dateEnd" prefWidth="110" promptText="Fin" styleClass="date-picker-flat"/>
                <Button onAction="#handleFilterUpdate" styleClass="btn-icon-only">
                    <graphic><SVGPath content="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" fill="#546E7A" scaleX="0.8" scaleY="0.8"/></graphic>
                    <tooltip><Tooltip text="Actualiser"/></tooltip>
                </Button>
            </HBox>

            <MenuButton fx:id="userMenu" text="Pharmacien" styleClass="user-menu-btn">
                <graphic>
                    <SVGPath content="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" fill="#009688"/>
                </graphic>
                <items>
                    <MenuItem text="Se Déconnecter" onAction="#handleLogout"/>
                </items>
            </MenuButton>
        </HBox>

        <GridPane hgap="20" vgap="20">
            <columnConstraints>
                <ColumnConstraints percentWidth="33.3"/>
                <ColumnConstraints percentWidth="33.3"/>
                <ColumnConstraints percentWidth="33.3"/>
            </columnConstraints>

            <VBox styleClass="kpi-card" GridPane.columnIndex="0">
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <StackPane styleClass="icon-bg-teal">
                        <SVGPath content="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z" fill="#009688"/>
                    </StackPane>
                    <VBox>
                        <Label text="Chiffre d'Affaires" styleClass="kpi-label"/>
                        <Label fx:id="lblSales" text="1,250.00 €" styleClass="kpi-value"/>
                    </VBox>
                </HBox>
            </VBox>

            <VBox styleClass="kpi-card" GridPane.columnIndex="1"
                  onMouseClicked="#goToCommande"
                  style="-fx-cursor: hand;">
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <StackPane styleClass="icon-bg-red">
                        <SVGPath content="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" fill="#D32F2F"/>
                    </StackPane>
                    <VBox>
                        <Label text="Stock Critique" styleClass="kpi-label"/>
                        <Label fx:id="lblAlerts" text="3 Articles" styleClass="kpi-value-alert"/>
                    </VBox>
                </HBox>
            </VBox>

            <VBox styleClass="kpi-card" GridPane.columnIndex="2"
                  onMouseClicked="#goToReception"
                  style="-fx-cursor: hand;">
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <StackPane styleClass="icon-bg-orange">
                        <SVGPath content="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z" fill="#F57C00"/>
                    </StackPane>
                    <VBox>
                        <Label text="Commandes en cours" styleClass="kpi-label"/>
                        <Label fx:id="lblOrders" text="5" styleClass="kpi-value"/>
                    </VBox>
                </HBox>
            </VBox>
        </GridPane>

        <HBox spacing="25" VBox.vgrow="ALWAYS">

            <VBox styleClass="card-pane" HBox.hgrow="ALWAYS">
                <HBox alignment="CENTER_LEFT">
                    <Label text="Évolution des Ventes" styleClass="section-header"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Label text="7 derniers jours" style="-fx-text-fill: #90A4AE; -fx-font-size: 11px;"/>
                </HBox>

                <AreaChart fx:id="salesChart" legendVisible="false" verticalGridLinesVisible="false" horizontalGridLinesVisible="true" prefHeight="350">
                    <xAxis><CategoryAxis side="BOTTOM" tickLabelFill="#78909C"/></xAxis>
                    <yAxis><NumberAxis side="LEFT" tickLabelFill="#78909C"/></yAxis>
                </AreaChart>
            </VBox>

            <VBox spacing="15" minWidth="260" maxWidth="300">
                <Label text="Actions Rapides" styleClass="section-header"/>

                <Button text="Nouvelle Vente" maxWidth="Infinity" styleClass="btn-tile-primary" onAction="#goToVente">
                    <graphic><SVGPath content="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 9h-2V7h-2v5H6v2h2v5h2v-5h5v-2z" fill="WHITE"/></graphic>
                </Button>

                <Button text="Gestion Stock" maxWidth="Infinity" styleClass="btn-tile-secondary" onAction="#goToStock">
                    <graphic><SVGPath content="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4z" fill="#546E7A"/></graphic>
                </Button>

                <Button text="Historique" maxWidth="Infinity" styleClass="btn-tile-secondary" onAction="#goToHistory">
                    <graphic><SVGPath content="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z" fill="#546E7A"/></graphic>
                </Button>

                <Button text="Rapports PDF" maxWidth="Infinity" styleClass="btn-tile-secondary" onAction="#goToReports">
                    <graphic><SVGPath content="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5v1.5H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z" fill="#546E7A"/></graphic>
                </Button>

                <Button fx:id="btnAdminUsers" text="Nouvel Utilisateur"
                        maxWidth="Infinity" styleClass="btn-tile-outline"
                        visible="false" managed="false"
                        onAction="#handleCreateUser">
                    <graphic><SVGPath content="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="#FF9800"/></graphic>
                </Button>

                <Button fx:id="btnAdminLogs" text="Journal Système"
                        maxWidth="Infinity" styleClass="btn-tile-outline"
                        visible="false" managed="false"
                        onAction="#goToLogs">
                    <graphic>
                        <SVGPath content="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" fill="#FF9800"/>
                    </graphic>
                </Button>

                <Separator style="-fx-padding: 10 0;"/>

                <Button text="Exporter Données" maxWidth="Infinity" styleClass="btn-link" onAction="#handleSmartExport"/>
            </VBox>
        </HBox>
    </VBox>
</ScrollPane>