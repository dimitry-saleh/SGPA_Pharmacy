<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.shape.SVGPath?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.pharmacy.sgpa.controller.CommandeController"
            stylesheets="@../css/styles.css"
            prefHeight="700.0" prefWidth="1000.0"
            style="-fx-background-color: #F4F6F8;">

    <top>
        <HBox styleClass="top-bar" alignment="CENTER_LEFT" spacing="20">
            <padding><Insets top="15" right="20" bottom="15" left="20"/></padding>

            <VBox>
                <Label text="SGPA PHARMA" styleClass="app-logo-text"/>
                <Label text="Gestion des Commandes" styleClass="page-title"/>
            </VBox>

            <Region HBox.hgrow="ALWAYS"/>

            <Button text="MENU PRINCIPAL" onAction="#backToMenu" styleClass="btn-secondary">
                <graphic>
                    <SVGPath content="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" fill="#546E7A" scaleX="0.7" scaleY="0.7"/>
                </graphic>
            </Button>
        </HBox>
    </top>

    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE" styleClass="modern-tab-pane">

            <Tab text="Nouvelle Commande">
                <HBox spacing="20" style="-fx-padding: 20;">

                    <VBox spacing="15" HBox.hgrow="ALWAYS" styleClass="card-pane">
                        <Label text="Catalogue Fournisseur" styleClass="section-header"/>

                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <VBox spacing="5">
                                <Label text="Recherche Rapide" styleClass="label-small"/>
                                <TextField fx:id="txtSearch" promptText="Ex: Doliprane, Pfizer..." prefWidth="250" styleClass="input-field"/>
                            </VBox>

                            <VBox spacing="5">
                                <Label text="Filtrer par Fournisseur" styleClass="label-small"/>
                                <ComboBox fx:id="comboFournisseur" promptText="Tous les fournisseurs" prefWidth="250" styleClass="combo-box-modern"/>
                            </VBox>

                            <Region HBox.hgrow="ALWAYS"/>

                            <VBox alignment="CENTER_RIGHT" spacing="5">
                                <Label text="." styleClass="label-small" style="-fx-text-fill: transparent;"/>
                                <CheckBox fx:id="chkShowAll" text="Afficher tout le stock" style="-fx-text-fill: #546E7A; -fx-cursor: hand;"/>
                            </VBox>
                        </HBox>

                        <Separator/>

                        <TableView fx:id="tableAlerts" VBox.vgrow="ALWAYS" styleClass="modern-table">
                            <columns>
                                <TableColumn fx:id="colNom" text="Désignation Médicament" prefWidth="250"/>
                                <TableColumn fx:id="colStock" text="Stock Actuel" prefWidth="100"/>
                                <TableColumn fx:id="colSeuil" text="Seuil Min" prefWidth="80"/>
                            </columns>
                            <columnResizePolicy>
                                <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                            </columnResizePolicy>
                        </TableView>

                        <HBox spacing="15" alignment="CENTER_LEFT" styleClass="action-bar">
                            <Label text="Quantité :" style="-fx-font-weight: bold; -fx-text-fill: #37474F;"/>
                            <TextField fx:id="txtQuantity" text="50" prefWidth="80" styleClass="input-field"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="AJOUTER AU BON" onAction="#addToOrder" styleClass="btn-primary">
                                <graphic>
                                    <SVGPath content="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="WHITE"/>
                                </graphic>
                            </Button>
                        </HBox>
                    </VBox>

                    <VBox spacing="15" prefWidth="320" minWidth="320" styleClass="receipt-card">
                        <HBox alignment="CENTER_LEFT">
                            <Label text="Bon de Commande" styleClass="receipt-header"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label text="#Brouillon" style="-fx-text-fill: #90A4AE; -fx-font-size: 10px;"/>
                        </HBox>

                        <Separator/>

                        <TableView fx:id="tableOrder" VBox.vgrow="ALWAYS" styleClass="modern-table-small">
                            <columns>
                                <TableColumn fx:id="colOrderNom" text="Médicament" prefWidth="180"/>
                                <TableColumn fx:id="colOrderQte" text="Qté" prefWidth="60"/>
                            </columns>
                        </TableView>

                        <VBox spacing="10" style="-fx-padding: 10 0 0 0;">
                            <Button text="VALIDER &amp; ENVOYER" maxWidth="Infinity" onAction="#saveOrder" styleClass="btn-success">
                                <graphic>
                                    <SVGPath content="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="WHITE"/>
                                </graphic>
                            </Button>
                        </VBox>
                    </VBox>
                </HBox>
            </Tab>

            <Tab text="Réception des Commandes">
                <HBox spacing="20" style="-fx-padding: 20;">

                    <VBox styleClass="card-pane" HBox.hgrow="ALWAYS">
                        <Label text="Commandes en Attente" styleClass="section-header"/>
                        <Label text="Sélectionnez une commande pour voir les détails" styleClass="label-small"/>

                        <TableView fx:id="tablePending" VBox.vgrow="ALWAYS" styleClass="modern-table">
                            <columns>
                                <TableColumn fx:id="colCmdId" text="N°" prefWidth="60"/>
                                <TableColumn fx:id="colCmdDate" text="Date" prefWidth="120"/>
                                <TableColumn fx:id="colCmdFournisseur" text="Fournisseur" prefWidth="200"/>
                                <TableColumn fx:id="colCmdStatut" text="Statut" prefWidth="120"/>
                            </columns>
                            <columnResizePolicy>
                                <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                            </columnResizePolicy>
                        </TableView>

                        <HBox alignment="CENTER_RIGHT" style="-fx-padding: 15 0 0 0;">
                            <Button text="CONFIRMER LA RÉCEPTION" styleClass="btn-warning" onAction="#handleReception">
                                <graphic>
                                    <SVGPath content="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm-2 14l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z" fill="WHITE"/>
                                </graphic>
                            </Button>
                        </HBox>
                    </VBox>

                    <VBox styleClass="receipt-card" prefWidth="350" minWidth="300">
                        <Label text="Contenu de la Commande" styleClass="receipt-header"/>
                        <Separator/>

                        <TableView fx:id="tableReceptionDetails" VBox.vgrow="ALWAYS" styleClass="modern-table-small">
                            <columns>
                                <TableColumn fx:id="colDetailNom" text="Médicament" prefWidth="220"/>
                                <TableColumn fx:id="colDetailQte" text="Qté" prefWidth="60"/>
                            </columns>
                        </TableView>
                    </VBox>

                </HBox>
            </Tab>

        </TabPane>
    </center>
</BorderPane>